<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>신청 조회 | Haneul Worship Team</title>
  <link rel="stylesheet" href="assets/css/style.css" />
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; margin:0; }
    main.page { padding: 72px 16px 96px; } /* 상단 여백 추가 */

    .search-box{
      background:#f9f9ff; padding:20px; border-radius:12px; text-align:center;
      box-shadow:0 2px 8px rgba(0,0,0,0.1); max-width:500px; margin:0 auto;
    }
    .search-box input{
      width:80%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:8px;
    }
    .search-box button{
      background:#1e2a78; color:#fff; border:none; padding:10px 20px; margin-top:10px;
      border-radius:8px; cursor:pointer; font-weight:bold;
    }
    .search-box button:hover{ background:#162060; }

    .result-card{
      margin:30px auto 0; background:#fff; border-radius:12px; padding:20px;
      box-shadow:0 3px 10px rgba(0,0,0,0.1); max-width:600px; text-align:left;
    }
    .result-card h3{ margin-bottom:15px; font-size:20px; border-bottom:2px solid #eee; padding-bottom:8px; }
    .result-item{ margin:8px 0; font-size:16px; }

    .pill{ display:inline-block; padding:2px 10px; border-radius:999px; font-weight:700; font-size:14px; }
    .success{ background:#e6f7e6; color:#1a7f37; }
    .danger{ background:#fdecea; color:#d93025; }
    .warning{ background:#fff4e5; color:#b26a00; }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-container">
      <div class="logo">Haneul Worship</div>
      <nav>
        <ul>
          <li><a href="index.html#apply-section"><strong>신청</strong></a></li>
          <li><a href="check.html"><strong>신청 조회</strong></a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="page">
    <section>
      <div class="search-box">
        <h2>내 신청 내역 확인</h2>
        <input type="text" id="team" placeholder="팀 이름 (예: 중계팀)" />
        <input type="text" id="name" placeholder="이름 (예: 김하준)" />
        <br />
        <button id="searchBtn">조회</button>
        <div id="hint" style="margin-top:8px;font-size:13px;color:#666;"></div>
      </div>
      <div id="result"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-info">
        <div>
          <p><strong>상호:</strong> Haneul Worship Team</p>
          <p><strong>대표자:</strong> Jesus</p>
          <p><strong>사업자등록번호:</strong> I'm nothing. Without Love.</p>
        </div>
        <div>
          <p><strong>주소:</strong> 우리가 꿈꾸는 나라</p>
          <p><strong>전화:</strong> 기도</p>
          <p><strong>이메일:</strong> 찬양</p>
        </div>
      </div>
      <div class="copyright">
        <p>&copy; <span id="current-year"></span> Haneul Worship Team. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Papa Parse (CSV 파서) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHCTRS-AgdKrrgIc81tfGy-0Fj-0NkROsAH4-nBhuzCjQPO3U4GtlUFDDNwGhVNjkQAt-ruawXpzVi/pub?gid=1875163185&single=true&output=csv";
    let data = [];
    let ready = false;

    // 로딩
    document.getElementById('hint').textContent = '데이터 불러오는 중...';
    Papa.parse(SHEET_URL, {
      download: true,
      header: true,         // ← 헤더로 열 매칭 (열 순서 바뀌어도 안전)
      skipEmptyLines: true,
      complete: (res) => {
        data = res.data;
        ready = true;
        document.getElementById('hint').textContent = '팀 이름과 이름을 모두 정확히 입력하세요.';
      },
      error: () => {
        document.getElementById('hint').textContent = '데이터를 불러오지 못했습니다.';
      }
    });

    // 유틸: 다양한 헤더 후보 지원(띄어쓰기/표현 차이 대비)
    const pick = (row, keys) => {
      for (const k of keys) {
        if (row[k] !== undefined && row[k] !== null) return String(row[k]).trim();
      }
      return "";
    };

    // Enter로 조회
    ['team','name'].forEach(id => {
      document.getElementById(id).addEventListener('keydown', e => {
        if (e.key === 'Enter') search();
      });
    });
    document.getElementById('searchBtn').addEventListener('click', search);

    function search() {
      const team = document.getElementById('team').value.trim();
      const name = document.getElementById('name').value.trim();

      if (!ready) {
        showMsg('데이터 로딩 중입니다. 잠시 후 다시 시도하세요.');
        return;
      }
      if (!team || !name) {
        showMsg('팀 이름과 이름을 모두 입력하세요.');
        return;
      }

      // 헤더 이름 기반으로 정확 일치 검색
      const matches = data.filter(r =>
        pick(r, ['예배팀']) === team &&
        pick(r, ['이름']) === name
      );

      if (matches.length === 0) {
        showMsg('검색 결과 없음');
        return;
      }

      const r = matches[0];
      const pay     = pick(r, ['입금 현황','입금현황']);
      const item    = pick(r, ['구입','구입 내역','구입내역']);
      const amount  = pick(r, ['입금금액','금액']);
      const tshirt  = pick(r, ['티셔츠 사이즈','티셔츠사이즈','티셔츠']);
      const hoodie  = pick(r, ['후드집업 사이즈','후드집업사이즈','후드집업']);
      const receive = pick(r, ['수령여부','수령 여부','진행상태']);

      const payClass = /완료/.test(pay) ? 'success' : 'danger';
      const recvClass = /수령|완료/.test(receive) ? 'success' : 'warning';

      document.getElementById('result').innerHTML = `
        <div class="result-card">
          <h3>신청자: ${name} (${team})</h3>
          <div class="result-item"><strong>입금 현황:</strong> <span class="pill ${payClass}">${pay || '-'}</span></div>
          <div class="result-item"><strong>구입 내역:</strong> ${item || '-'}</div>
          <div class="result-item"><strong>금액:</strong> ${amount || '-'}</div>
          <div class="result-item"><strong>티셔츠 사이즈:</strong> ${tshirt || '-'}</div>
          <div class="result-item"><strong>후드집업 사이즈:</strong> ${hoodie || '-'}</div>
          <div class="result-item"><strong>수령 여부:</strong> <span class="pill ${recvClass}">${receive || '미수령'}</span></div>
        </div>
      `;
    }

    function showMsg(msg){
      document.getElementById('result').innerHTML =
        `<p style="text-align:center; margin-top:20px;">${msg}</p>`;
    }
  </script>
</body>
</html>
